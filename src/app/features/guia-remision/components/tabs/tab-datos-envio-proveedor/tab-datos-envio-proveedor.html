<div class="border-2 border-gray-300 rounded-xl overflow-hidden">

    <p-tabs value="0" lazy="true">
        <p-tablist>
            <p-tab value="0" class="py-3! data-[p-active=true]:bg-primary! data-[p-active=true]:text-white!">
                <div class="flex items-center gap-2">
                    <label for="" class="text-xs font-semibold pointer-events-none">Datos de envio</label>
                    @if(submitted && formDatosEnvio.invalid) {
                        <ng-icon name="tablerAlertCircle" />
                    }
                </div>
            </p-tab>
            <p-tab value="1" class="py-3! data-[p-active=true]:bg-primary! data-[p-active=true]:text-white!">
                <div class="flex items-center gap-2">
                    <label for="" class="text-xs font-semibold pointer-events-none">Datos del proveedor</label>
                    @if(submitted && formDatosProveedor.invalid) {
                        <ng-icon name="tablerAlertCircle" />
                    }
                </div>
            </p-tab>
        </p-tablist>
        <p-tabpanels>
            <p-tabpanel value="0">
                <div [formGroup]="formDatosEnvio" class="flex flex-col gap-4">
                    
                    @if( tipoGuia != 'TRANSPORTISTA'){
                        <div class="flex items-center gap-1">
                            <label for="" class="text-md font-semibold text-primary uppercase">TIPO DE TRANSPORTE:</label>
                            <ng-icon name="heroQuestionMarkCircleSolid" class="text-[14px]! min-w-3.25!" pTooltip="Privado: Cuando el transporte de bienes es realizado por el propietario con vehículos propios. Público: Cuando se contrata a un transportista para que traslade los bienes." tooltipStyleClass="text-xs! text-center" tooltipPosition="top"/>
                            <div class="flex flex-row gap-1">
                                <input #privado type="radio" id="tipo_transporte_publico" name="tipo_transporte" formControlName="tipo_transporte" value="PUBLICO" class="hidden">
                                <input #publico type="radio" id="tipo_transporte_privado" name="tipo_transporte" formControlName="tipo_transporte" value="PRIVADO" class="hidden">
                                <p-button size="small"  styleClass="text-xs!" class="text-xs!" (click)="publico.click()" label="Privado" [severity]="f_datosEnvio.tipo_transporte.value == 'PRIVADO' ? 'primary' : 'secondary'"></p-button>
                                <p-button size="small"  styleClass="text-xs!" class="text-xs!" (click)="privado.click()" label="Público" [severity]="f_datosEnvio.tipo_transporte.value == 'PUBLICO' ? 'primary' : 'secondary'"></p-button>
                            </div>
                        </div>
                    }

                    <div class="grid grid-cols-3 gap-4">
                        @if(f_datosEnvio.tipo_transporte.value == 'PRIVADO'){
                            <div class="items-center gap-2">
                                <label class="text-[11px]! text-gray-500 font-semibold">Fecha de inicio de traslado *</label>
                                <p-datepicker size="small" fluid [iconDisplay]="'input'" appendTo="body" [showIcon]="true" />
                            </div>
                        }@else {
                            <div class="items-center gap-2">
                                <label class="text-[11px]! text-gray-500 font-semibold">Fecha de entrega al transportista</label>
                                <p-datepicker size="small" fluid [iconDisplay]="'input'" appendTo="body" [showIcon]="true" />
                            </div>
                        }
                        @if( tipoGuia != 'TRANSPORTISTA'){
                            <div class="items-center gap-2">
                                <label class="text-[11px]! text-gray-500 font-semibold">Descripción del traslado</label>
                                <input placeholder="" pSize="small" fluid pInputText formControlName="descripcion_traslado" [class]="f_datosEnvio.descripcion_traslado.invalid && submitted ? ' shadow-none! border-primary-400! focus:border-primary-400!' : 'shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!' " [invalid]="f_datosEnvio.descripcion_traslado.invalid && submitted" />
                            </div>
                        }
                        
                        <div class="grid grid-cols-2 gap-4">
                             <div>
                                <label class="text-[11px]! text-gray-500 font-semibold">Und. del peso bruto *</label>
                                <p-select 
                                fluid
                                size="small" 
                                [inputSize]="2" 
                                panelStyleClass="text-xs!"
                                [class]=" f_datosEnvio.unidad_peso_bruto.invalid && submitted ? 'shadow-none! border-primary-400! focus:border-primary-400!' : ' shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!' "
                                [options]="grossWeightUnits" 
                                formControlName="unidad_peso_bruto" 
                                placeholder="" 
                                optionValue="value" 
                                optionLabel="description" 
                                appendTo="body"
                                />
                             </div>
                             <div>
                                <label class="text-[11px]! text-gray-500 font-semibold">Peso bruto total *</label>
                                <p-inputnumber fluid size="small" placeholder="0.000" formControlName="peso_bruto_total" inputId="minmaxfraction" mode="decimal" [maxFractionDigits]="3" [maxlength]="15" [class]="f_datosEnvio.peso_bruto_total.invalid && submitted ? ' shadow-none! border-primary-400! focus:border-primary-400!' : 'shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!' " [invalid]="f_datosEnvio.peso_bruto_total.invalid && submitted"/>
                             </div>
                        </div>

                        @if( tipoGuia == 'TRANSPORTISTA'){
                        <div class="items-center gap-2">
                            <label for="" class="text-[11px]! text-gray-500 font-semibold">Pagador del flete *</label>
                            <p-select 
                            fluid
                            size="small" 
                            [inputSize]="2" 
                            panelStyleClass="text-xs!"
                            [class]=" f_datosEnvio.pagador_flete.invalid && submitted ? 'shadow-none! border-primary-400! focus:border-primary-400!' : ' shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!' "
                            [options]="freightPayers" 
                            formControlName="pagador_flete" 
                            placeholder="" 
                            optionValue="value" 
                            optionLabel="description" 
                            appendTo="body"
                            />
                        </div>
                        }
                        
                    </div>

                    <div class="grid grid-cols-4 gap-4">
                        @if(f_datosEnvio.pagador_flete.value == 'SUBCONTRATADOR'){
                            <div class="items-center gap-2">
                                <label class="text-[11px]! text-gray-500 font-semibold">RUC *</label>
                                <input placeholder="" pSize="small" fluid pInputText formControlName="ruc_subcontratador" [class]="f_datosEnvio.ruc_subcontratador.invalid && submitted ? ' shadow-none! border-primary-400! focus:border-primary-400!' : 'shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!' " [invalid]="f_datosEnvio.ruc_subcontratador.invalid && submitted" />
                            </div>
                            <div class="items-center gap-2">
                                <label class="text-[11px]! text-gray-500 font-semibold">Nombre o Razón Social *</label>
                                <input placeholder="" pSize="small" fluid pInputText formControlName="nombre_rsocial_subcontratador" [class]="f_datosEnvio.nombre_rsocial_subcontratador.invalid && submitted ? ' shadow-none! border-primary-400! focus:border-primary-400!' : 'shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!' " [invalid]="f_datosEnvio.nombre_rsocial_subcontratador.invalid && submitted" />
                            </div>
                        }

                        @if(f_datosEnvio.pagador_flete.value == 'OTRO'){
                            <div class="items-center gap-2">
                                <label class="text-[11px]! text-gray-500 font-semibold">N° Doc. de identidad *</label>
                                <input placeholder="" pSize="small" fluid pInputText formControlName="numero_documento_tercero" [class]="f_datosEnvio.numero_documento_tercero.invalid && submitted ? ' shadow-none! border-primary-400! focus:border-primary-400!' : 'shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!' " [invalid]="f_datosEnvio.numero_documento_tercero.invalid && submitted" />
                            </div>
                            <div class="items-center gap-2">
                                <label class="text-[11px]! text-gray-500 font-semibold">Nombre o Razón Social *</label>
                                <input placeholder="" pSize="small" fluid pInputText formControlName="nombre_rsocial_tercero" [class]="f_datosEnvio.nombre_rsocial_tercero.invalid && submitted ? ' shadow-none! border-primary-400! focus:border-primary-400!' : 'shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!' " [invalid]="f_datosEnvio.nombre_rsocial_tercero.invalid && submitted" />
                            </div>
                        }
                    </div>

                    <p-divider class="my-0!"></p-divider>

                    <div class="flex flex-col gap-4">
                        <label for="" class="text-md font-semibold text-primary">Datos del vehículo</label>
                        <div formArrayName="vehiculos" class="flex flex-col gap-0">
                            @for (vehiculo of vehiculos.controls; track $index) {
                                <p-fieldset styleClass="text-xs!" [legend]="'Vehículo #' + ($index+1)">
                                    <div  class="flex flex-row items-center" [formGroupName]="$index">
                                        <div class="w-full sm:grid grid-cols-1! lg:grid-cols-3! xl:grid-cols-4! gap-x-4 gap-y-2">
                                            <div>
                                                <label class="text-[11px]! text-gray-500 font-semibold">{{ $index == 0 ? 'Placa principal *' : 'Placa secundaria *' }}</label>
                                                <input 
                                                placeholder="" 
                                                pSize="small" 
                                                fluid 
                                                pInputText 
                                                class="text-xs! shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!" formControlName="placa_vehiculo" 
                                                [placeholder]="$index == 0 ? 'Placa principal *' : 'Placa secundaria *'" [invalid]="vehiculo.get('placa_vehiculo')?.invalid && (vehiculo.get('placa_vehiculo')?.touched || submitted)"/>
                                                @if (vehiculo.get('placa_vehiculo')?.invalid && (vehiculo.get('placa_vehiculo')?.touched || submitted)) {
                                                    <p-message severity="error" size="small" variant="simple"><span class="text-[10px]! ">Este campo es requerido.</span></p-message>
                                                }
                                            </div>
                                            <div class="flex flex-col">
                                                <label class="text-[11px]! text-gray-500 font-semibold truncate" title="Entidad emisora de la autorización vahícular (opcional)" >Entidad emisora de la autorización vahícular (opcional)</label>
                                                <p-select 
                                                fluid
                                                size="small" 
                                                [inputSize]="2" 
                                                inputId="text-xs"
                                                panelStyleClass="text-xs!"
                                                class="shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!"
                                                [options]="ussuingEntities" 
                                                placeholder="Seleccionar..." 
                                                optionValue="value" 
                                                optionLabel="description" 
                                                appendTo="body"
                                                [showClear]="true"
                                                formControlName="entidad_emisora_autoriza_vehiculo"
                                                pTooltip="Entidad emisora de la autorización vahícular (opcional)"
                                                tooltipPosition="top"
                                                tooltipStyleClass="text-xs!"
                                                />
                                            </div>
                                            <div>
                                                <label class="text-[11px]! text-gray-500 font-semibold truncate">N° de autorización vehícular (opcional)</label>
                                                <input placeholder="" pSize="small" fluid pInputText class="text-xs! shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!" formControlName="numero_autoriza_vehicular_vehiculo"/>
                                            </div>
                                        </div>
                                        @if(vehiculos.length > 1){
                                            <div class="w-12.5 text-end">
                                                @if($index > 0){
                                                    <p-button pTooltip="Quitar vehiculo" tooltipStyleClass="text-[10px]! " tooltipPosition="left" class="text-xs! w-6! h-6!" size="small" icon="pi pi-times font-semibold!" styleClass="w-6! h-6!" (click)="evtRemoveVehiculo($index)" rounded="true" severity="primary"/>
                                                }
                                            </div>
                                        }
                                    </div>
                                </p-fieldset>
                            }
                        </div>
                        @if(vehiculos.length < 3){
                            <p-button (onClick)="evtAddVehiculo()" size="small" styleClass="text-xs!" class="text-xs!" severity="primary" label="Agregar vehículo"></p-button>
                        }
                    </div>
                    <p-divider class="my-0!"></p-divider>

                    <div class="flex flex-col gap-4">
                        <label for="" class="text-md font-semibold text-primary">Datos del conductor</label>
                        <div formArrayName="conductores" class="flex flex-col gap-0">
                            @for (conductor of conductores.controls; track $index) {
                                <p-fieldset styleClass="text-xs!" [legend]="'Conductor #' + ($index+1)">
                                    <div  class="flex flex-row items-center" [formGroupName]="$index">
                                        <div class="w-full grid grid-cols-4 gap-x-4 gap-y-2">
                                                <div>
                                                    <label class="text-[11px]! text-gray-500 font-semibold">Tipo de documento *</label>
                                                    <p-select 
                                                    fluid
                                                    size="small"
                                                    [inputSize]="2"
                                                    panelStyleClass="text-xs!"
                                                    class="shadow-none! focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!"
                                                    inputId="text-xs"
                                                    [options]="documentEntityTypes" 
                                                    placeholder="Seleccionar..." 
                                                    optionValue="value" 
                                                    optionLabel="description" 
                                                    appendTo="body"
                                                    formControlName="tipo_documento_conductor"
                                                    [invalid]="conductor.get('tipo_documento_conductor')?.invalid && ( conductor.get('tipo_documento_conductor')?.touched || submitted)"
                                                    />
                                                    @if (conductor.get('tipo_documento_conductor')?.invalid && (conductor.get('tipo_documento_conductor')?.touched || submitted)) {
                                                        <p-message severity="error" size="small" variant="simple"><span class="text-[10px]! ">Este campo es requerido.</span></p-message>
                                                    }
                                                </div>
                                                <div>
                                                    <label class="text-[11px]! text-gray-500 font-semibold">N° Doc. de identidad *</label>
                                                    <input placeholder="" 
                                                    pSize="small" 
                                                    fluid 
                                                    pInputText 
                                                    class="text-xs! shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!" formControlName="numero_documento_conductor"
                                                    [invalid]="conductor.get('numero_documento_conductor')?.invalid && (conductor.get('numero_documento_conductor')?.touched || submitted)"/>
                                                    @if (conductor.get('numero_documento_conductor')?.invalid && (conductor.get('numero_documento_conductor')?.touched || submitted)) {
                                                        <p-message severity="error" size="small" variant="simple"><span class="text-[10px]! ">Este campo es requerido.</span></p-message>
                                                    }
                                                </div>
                                                <div>
                                                    <label class="text-[11px]! text-gray-500 font-semibold">N° de licencia o brevete *</label>
                                                    <input 
                                                    placeholder="" 
                                                    pSize="small" 
                                                    fluid 
                                                    pInputText 
                                                    class="text-xs! shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!" formControlName="numero_licencia_brevete_conductor"
                                                    [invalid]="conductor.get('numero_licencia_brevete_conductor')?.invalid && (conductor.get('numero_licencia_brevete_conductor')?.touched || submitted)"
                                                    />
                                                    @if (conductor.get('numero_licencia_brevete_conductor')?.invalid && (conductor.get('numero_licencia_brevete_conductor')?.touched || submitted)) {
                                                        <p-message severity="error" size="small" variant="simple"><span class="text-[10px]! ">Este campo es requerido.</span></p-message>
                                                    }
                                                </div>
                                                <div>
                                                    <label class="text-[11px]! text-gray-500 font-semibold">Nombre del conductor *</label>
                                                    <input 
                                                    placeholder="" 
                                                    pSize="small" 
                                                    fluid 
                                                    pInputText 
                                                    class="text-xs! shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!" formControlName="nombre_conductor"
                                                    [invalid]="conductor.get('nombre_conductor')?.invalid && (conductor.get('nombre_conductor')?.touched || submitted)"/>
                                                    @if (conductor.get('nombre_conductor')?.invalid && (conductor.get('nombre_conductor')?.touched || submitted)) {
                                                        <p-message severity="error" size="small" variant="simple"><span class="text-[10px]! ">Este campo es requerido.</span></p-message>
                                                    }
                                                </div>
                                                <div>
                                                    <label class="text-[11px]! text-gray-500 font-semibold">Apellido del conductor *</label>
                                                    <input 
                                                    placeholder="" 
                                                    pSize="small" 
                                                    fluid 
                                                    pInputText 
                                                    class="text-xs! shadow-none!  focus:border-gray-500! hover:border-gray-400! hover:shadow-xs!" formControlName="apellido_conductor"
                                                    [invalid]="conductor.get('apellido_conductor')?.invalid && (conductor.get('apellido_conductor')?.touched || submitted)"
                                                    />
                                                    @if (conductor.get('apellido_conductor')?.invalid && (conductor.get('apellido_conductor')?.touched || submitted)) {
                                                        <p-message severity="error" size="small" variant="simple"><span class="text-[10px]! ">Este campo es requerido.</span></p-message>
                                                    }
                                                </div>
                                            
                                        </div>
                                        @if(conductores.length > 1){
                                            <div class="w-12.5 text-end">
                                                @if($index > 0){
                                                    <p-button pTooltip="Quitar conductor" tooltipStyleClass="text-[10px]! " tooltipPosition="left" class="text-xs! w-6! h-6!" size="small" icon="pi pi-times font-semibold!" styleClass="w-6! h-6!" (click)="evtRemoveCoductor($index)" rounded="true" severity="primary"/>
                                                }
                                            </div>
                                        }
                                        
                                    </div>
                                </p-fieldset>
                            }
                        </div>
                        @if(conductores.length < 3){
                            <p-button (onClick)="evtAddConductor()" size="small" styleClass="text-xs!" class="text-xs!" severity="primary" label="Agregar conductor"></p-button>
                        }
                    </div>

                </div>
            </p-tabpanel>
            <p-tabpanel value="1">
                <div [formGroup]="formDatosProveedor" class="flex flex-col gap-4">
                    
                </div>
            </p-tabpanel>
        </p-tabpanels>
    </p-tabs>
</div>

<p-confirmdialog styleClass="max-w-[400px]" #cd>
    <ng-template #headless let-message let-onAccept="onAccept" let-onReject="onReject">
        <div class="flex flex-col items-center p-8  rounded-xl">
            <div
                class="rounded-full bg-blue-200 text-blue-700 inline-flex justify-center items-center h-24 w-24 -mt-20"
            >
                <i class="font-bold pi pi-question text-5xl!"></i>
            </div>
            <span class="font-semibold text-xl block mb-2 mt-6 text-center">{{ message.header }}</span>
            <p class="mb-0 text-xs">{{ message.message }}</p>
            <div class="flex items-center gap-2 mt-6">
                <p-button label="Aceptar" (onClick)="onAccept()" styleClass="w-32"></p-button>
                <p-button label="Cancelar" severity="secondary" (onClick)="onReject()" styleClass="w-32"></p-button>
            </div>
        </div>
    </ng-template>
</p-confirmdialog>
